# 판정 기준 협의 워크샵 (Week 1 필수)

**작성일**: 2025-12-17
**목적**: STD vs TEST 비교 시스템의 판정 임계값 결정
**참석자**: [채울 것] 품질 관리자, 생산 엔지니어, 검사원, 시스템 개발자
**일정**: Week 1 (MVP 시작 전 필수 완료)

---

## 🎯 워크샵 목표

STD 기반 비교 시스템이 **"PASS"**와 **"FAIL"**을 판단하기 위한 **명확한 수치 기준**을 합의합니다.

### 결정해야 할 것
1. 구조 유사도 기준 (상관계수, 경계 위치)
2. 색상 유사도 기준 (평균 ΔE, 95% ΔE)
3. 종합 점수 임계값 (PASS, WARNING, FAIL)
4. 신뢰도 기준 (자동 판정 vs 수동 검토)

---

## 📋 워크샵 진행 순서

### Phase 1: 현재 기준 조사 (30분)
**질문**: "지금은 어떻게 합격/불합격을 판단하나요?"

#### 1-1. 육안 검사 기준
- 색상 차이를 어떻게 판단하는가?
  - [ ] 명암 차이 (밝기)
  - [ ] 색조 차이 (색깔)
  - [ ] 전체적 느낌
  - [ ] 기타: ________________

- 구조 차이를 어떻게 판단하는가?
  - [ ] Zone 경계 위치
  - [ ] Zone 크기
  - [ ] 중심 치우침
  - [ ] 기타: ________________

#### 1-2. 현재 불량 사례 검토
**준비물**: OK 샘플 5개, NG 샘플 5개

| 샘플 ID | 판정 | 불량 이유 | 수치화 가능? |
|---------|------|-----------|--------------|
| SAMPLE-001 | OK | - | - |
| SAMPLE-002 | OK | - | - |
| SAMPLE-003 | OK | - | - |
| SAMPLE-004 | OK | - | - |
| SAMPLE-005 | OK | - | - |
| SAMPLE-006 | NG | [채울 것] | [채울 것] |
| SAMPLE-007 | NG | [채울 것] | [채울 것] |
| SAMPLE-008 | NG | [채울 것] | [채울 것] |
| SAMPLE-009 | NG | [채울 것] | [채울 것] |
| SAMPLE-010 | NG | [채울 것] | [채울 것] |

**분석**:
- NG 이유 중 가장 빈번한 것: ________________
- NG 이유 중 시스템이 감지 가능한 것: ________________
- NG 이유 중 육안으로만 판단 가능한 것: ________________

---

### Phase 2: 기준값 제안 및 검증 (60분)

#### 2-1. 구조 유사도 기준

##### A. Radial Profile 상관계수
**의미**: STD와 TEST의 전체적인 패턴 유사도 (0 ~ 1, 1이 완벽)

**제안 기준**:
```
✅ PASS:   상관계수 >= 0.85 (85% 유사)
⚠️ WARNING: 0.75 <= 상관계수 < 0.85
❌ FAIL:   상관계수 < 0.75
```

**검증**:
- [ ] OK 샘플 5개 분석 → 평균 상관계수: ______
- [ ] NG 샘플 5개 분석 → 평균 상관계수: ______
- [ ] 기준값이 적절한가? → YES / NO
- [ ] 조정 필요 시 제안값: ______

**최종 합의**:
```
PASS 기준: 상관계수 >= ______ (기본: 0.85)
```

##### B. Zone 경계 위치 차이
**의미**: STD 대비 Zone 경계가 몇 % 이동했는가?

**제안 기준**:
```
✅ PASS:   경계 이동 ≤ ±3.0%
⚠️ WARNING: ±3.0% < 경계 이동 ≤ ±5.0%
❌ FAIL:   경계 이동 > ±5.0%
```

**예시**:
- STD: Zone A-B 경계 = 245px
- TEST: Zone A-B 경계 = 255px
- 차이: (255 - 245) / 245 × 100 = **+4.1%** → WARNING

**검증**:
- [ ] OK 샘플 5개 분석 → 평균 경계 차이: ______%
- [ ] NG 샘플 5개 분석 → 평균 경계 차이: ______%
- [ ] 기준값이 적절한가? → YES / NO

**최종 합의**:
```
PASS 기준: 경계 이동 ≤ ±______% (기본: 3.0%)
```

---

#### 2-2. 색상 유사도 기준

##### A. 평균 ΔE (CIEDE2000)
**의미**: 전체 픽셀의 평균 색상 차이

**배경 지식**:
- ΔE < 1.0: 육안으로 거의 구분 불가
- ΔE = 2.0 ~ 3.0: 주의 깊게 보면 차이 인식 가능
- ΔE > 5.0: 명확한 차이, 일반인도 인식

**제안 기준**:
```
✅ PASS:   평균 ΔE ≤ 3.0
⚠️ WARNING: 3.0 < 평균 ΔE ≤ 5.0
❌ FAIL:   평균 ΔE > 5.0
```

**검증**:
- [ ] OK 샘플 5개 분석 → 평균 ΔE: ______
- [ ] NG 샘플 5개 분석 → 평균 ΔE: ______
- [ ] 기준값이 적절한가? → YES / NO

**최종 합의**:
```
PASS 기준: 평균 ΔE ≤ ______ (기본: 3.0)
```

##### B. 95% ΔE (극값 관리)
**의미**: 상위 5% 나쁜 픽셀의 색상 차이 (국소 결함 감지)

**왜 필요한가?**
- 평균 ΔE = 2.5 (OK)인데, 5% 영역이 ΔE = 15 (NG) → 육안으로 NG
- 극값 관리로 국소 결함 감지

**제안 기준**:
```
✅ PASS:   95% ΔE ≤ 5.0
⚠️ WARNING: 5.0 < 95% ΔE ≤ 8.0
❌ FAIL:   95% ΔE > 8.0
```

**검증**:
- [ ] OK 샘플 5개 분석 → 평균 95% ΔE: ______
- [ ] NG 샘플 5개 분석 → 평균 95% ΔE: ______
- [ ] 기준값이 적절한가? → YES / NO

**최종 합의**:
```
PASS 기준: 95% ΔE ≤ ______ (기본: 5.0)
```

---

#### 2-3. 종합 점수 임계값

##### A. 총점 계산 방식
```
총점 = 구조 점수 × 40% + 색상 점수 × 60%

구조 점수 = (
    상관계수 × 100 × 50% +
    경계 점수 × 50%
)

색상 점수 = (
    100 - 평균 ΔE × 10
)
```

**예시**:
- 상관계수 = 0.92 → 92점
- 경계 차이 = 2.1% (기준 3.0%) → 93점
- 구조 점수 = 92 × 0.5 + 93 × 0.5 = **92.5점**
- 평균 ΔE = 2.3 → 색상 점수 = 100 - 2.3 × 10 = **77점**
- **총점 = 92.5 × 0.4 + 77 × 0.6 = 83.2점**

##### B. 판정 임계값

**제안 기준**:
```
✅ PASS:   총점 >= 80
⚠️ WARNING: 60 <= 총점 < 80
❌ FAIL:   총점 < 60
```

**WARNING의 의미**:
- "재검사 필요" 또는 "수동 확인 필요"
- 자동으로 FAIL 처리하지 않음

**검증**:
- [ ] OK 샘플 5개 → 평균 총점: ______
- [ ] NG 샘플 5개 → 평균 총점: ______
- [ ] 기준값이 적절한가? → YES / NO

**최종 합의**:
```
PASS 기준: 총점 >= ______ (기본: 80)
WARNING 기준: 총점 >= ______ (기본: 60)
```

---

#### 2-4. 신뢰도 (Confidence) 기준

**판정과 신뢰도는 별개**:
- `FAIL + 신뢰도 95%` → "확실한 불량"
- `FAIL + 신뢰도 60%` → "재검사 필요" (RETAKE)
- `PASS + 신뢰도 95%` → "확실한 합격"

**신뢰도 구성 요소**:
1. Lens 검출 품질 (0-100)
2. Zone 분할 품질 (0-100)
3. Alignment 품질 (0-100)
4. 데이터 완전성 (0-100)

**제안 기준**:
```
신뢰도 >= 80% → 자동 판정 신뢰
신뢰도 < 80% → RETAKE (재촬영 권장)
```

**검증**:
- [ ] 신뢰도 낮은 케이스 예시가 있는가? → YES / NO
- [ ] 어떤 경우에 신뢰도가 낮은가? ________________

**최종 합의**:
```
자동 판정 신뢰 기준: 신뢰도 >= ______% (기본: 80)
```

---

### Phase 3: 예외 케이스 정의 (30분)

#### 3-1. RETAKE (재촬영) 조건
어떤 경우에 "다시 촬영하세요"를 출력할 것인가?

**제안**:
- [ ] Lens 검출 실패 → RETAKE
- [ ] 신뢰도 < 80% → RETAKE
- [ ] 이미지 품질 저하 (흐림, 노출 과다/부족) → RETAKE
- [ ] 기타: ________________

**최종 합의**:
```
RETAKE 조건:
1. ________________
2. ________________
3. ________________
```

#### 3-2. MANUAL_REVIEW (수동 검토) 조건
어떤 경우에 "사람이 확인하세요"를 출력할 것인가?

**제안**:
- [ ] WARNING 판정 → MANUAL_REVIEW
- [ ] 판정과 육안이 다를 가능성 (경계 케이스) → MANUAL_REVIEW
- [ ] 신뢰도 60~80% → MANUAL_REVIEW
- [ ] 기타: ________________

**최종 합의**:
```
MANUAL_REVIEW 조건:
1. ________________
2. ________________
```

---

### Phase 4: 가중치 조정 (15분)

현재 제안:
```
총점 = 구조 점수 × 40% + 색상 점수 × 60%
```

**질문**: "구조와 색상 중 어느 것이 더 중요한가?"
- [ ] 색상이 더 중요 (60% 유지 또는 증가)
- [ ] 구조가 더 중요 (50:50 또는 구조 60%)
- [ ] 동일 중요 (50:50)

**최종 합의**:
```
총점 = 구조 점수 × ______% + 색상 점수 × ______%
```

---

## 📝 워크샵 결과 정리

### 최종 합의 기준 (JSON 형식)

```json
{
  "judgment_criteria": {
    "structure": {
      "min_profile_correlation": 0.85,
      "max_boundary_difference_percent": 3.0
    },
    "color": {
      "max_mean_delta_e": 3.0,
      "max_p95_delta_e": 5.0
    },
    "overall": {
      "pass_score_threshold": 80.0,
      "warning_score_threshold": 60.0,
      "structure_weight": 0.4,
      "color_weight": 0.6
    },
    "confidence": {
      "min_confidence_for_auto_judgment": 80.0
    }
  },
  "special_rules": {
    "retake_conditions": [
      "lens_detection_failed",
      "confidence < 80%",
      "image_quality_low"
    ],
    "manual_review_conditions": [
      "judgment == WARNING",
      "60% <= confidence < 80%"
    ]
  }
}
```

### 승인 서명

| 역할 | 이름 | 서명 | 날짜 |
|------|------|------|------|
| 품질 관리자 | | | |
| 생산 엔지니어 | | | |
| 검사원 대표 | | | |
| 시스템 개발자 | | | |

---

## 🔄 사후 관리

### 기준 튜닝 계획
**Week 7-10 (P1 단계)**에서 실제 데이터로 검증 및 튜닝:

1. **100 샘플 수집**
   - 시스템 판정 vs 사람 판정 비교
   - 일치도 측정

2. **False Positive / False Negative 분석**
   - False Positive: 시스템 FAIL, 사람 PASS (과도한 기준)
   - False Negative: 시스템 PASS, 사람 FAIL (느슨한 기준)

3. **임계값 조정**
   - False Positive > 5% → 기준 완화
   - False Negative > 2% → 기준 강화

4. **재승인**
   - 조정된 기준으로 다시 워크샵
   - 최종 승인

---

## 📌 다음 단계 (Week 1)

워크샵 완료 후:
1. ✅ 합의된 기준을 `src/schemas/judgment_schemas.py`의 `JudgmentCriteria` 기본값으로 반영
2. ✅ 기준을 설정 파일로 저장 (`config/judgment_criteria.json`)
3. ✅ 검증 스크립트 작성 (`tools/validate_judgment_criteria.py`)
4. ✅ Week 2-3 STD 등록 시작

---

**작성자**: Claude Sonnet 4.5
**검토 필요**: 품질 관리팀, 생산팀
**승인 필요**: Week 1 필수 완료
